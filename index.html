
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Status S√≥brio - Quiz de Sobriedade</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #10b981 0%, #14b8a6 100%);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .progress-bar {
            transition: width 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-emerald-50 via-teal-50 to-cyan-50 min-h-screen">
    <div id="app"></div>

    <script>
        // Configura√ß√£o do Supabase
        const SUPABASE_URL = 'YOUR_SUPABASE_URL';
        const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY';
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Estado da aplica√ß√£o
        let state = {
            screen: 'auth', // auth, emailConfirm, quiz, plan, dashboard
            authMode: 'signup', // signup, login
            currentModule: 0,
            currentQuestion: 0,
            answers: {},
            user: null,
            userName: '',
            soberDate: null,
            isPremium: false,
            loading: false,
            error: null
        };

        // Dados do quiz
        const quizModules = [
            {
                title: "M√≥dulo A: Hist√≥rico e Frequ√™ncia de Uso",
                icon: "‚è∞",
                color: "from-blue-500 to-cyan-600",
                questions: [
                    {
                        id: "a1",
                        question: "Com que frequ√™ncia voc√™ consumia bebidas alco√≥licas?",
                        type: "multiple",
                        options: [
                            "Diariamente",
                            "4-6 vezes por semana",
                            "2-3 vezes por semana",
                            "Uma vez por semana",
                            "Ocasionalmente (menos de uma vez por semana)"
                        ]
                    },
                    {
                        id: "a2",
                        question: "H√° quanto tempo voc√™ consome ou consumia √°lcool regularmente?",
                        type: "multiple",
                        options: [
                            "Menos de 1 ano",
                            "1-3 anos",
                            "4-7 anos",
                            "8-15 anos",
                            "Mais de 15 anos"
                        ]
                    },
                    {
                        id: "a3",
                        question: "Quantas doses voc√™ costumava consumir em uma ocasi√£o t√≠pica?",
                        type: "multiple",
                        options: [
                            "1-2 doses",
                            "3-4 doses",
                            "5-7 doses",
                            "8-10 doses",
                            "Mais de 10 doses"
                        ]
                    },
                    {
                        id: "a4",
                        question: "Voc√™ j√° tentou parar de beber antes?",
                        type: "multiple",
                        options: [
                            "Nunca tentei",
                            "Tentei 1 vez",
                            "Tentei 2-3 vezes",
                            "Tentei 4-6 vezes",
                            "Tentei mais de 6 vezes"
                        ]
                    },
                    {
                        id: "a5",
                        question: "Qual foi o per√≠odo mais longo que voc√™ ficou sem beber?",
                        type: "multiple",
                        options: [
                            "Menos de 1 semana",
                            "1-4 semanas",
                            "1-3 meses",
                            "3-6 meses",
                            "Mais de 6 meses"
                        ]
                    },
                    {
                        id: "a6",
                        question: "Em que idade voc√™ come√ßou a consumir √°lcool regularmente?",
                        type: "multiple",
                        options: [
                            "Antes dos 15 anos",
                            "15-18 anos",
                            "19-25 anos",
                            "26-35 anos",
                            "Acima de 35 anos"
                        ]
                    },
                    {
                        id: "a7",
                        question: "Voc√™ costumava beber sozinho(a)?",
                        type: "likert",
                        scale: "1 = Nunca | 5 = Sempre"
                    },
                    {
                        id: "a8",
                        question: "Com que frequ√™ncia voc√™ bebia pela manh√£ para aliviar sintomas de ressaca?",
                        type: "likert",
                        scale: "1 = Nunca | 5 = Sempre"
                    },
                    {
                        id: "a9",
                        question: "Voc√™ sentia necessidade de aumentar a quantidade de √°lcool para sentir o mesmo efeito?",
                        type: "likert",
                        scale: "1 = Nunca | 5 = Sempre"
                    }
                ]
            },
            {
                title: "M√≥dulo B: Gatilhos e Consequ√™ncias Emocionais",
                icon: "‚ù§Ô∏è",
                color: "from-purple-500 to-pink-600",
                questions: [
                    {
                        id: "b1",
                        question: "O estresse do trabalho ou estudos te levava a beber?",
                        type: "likert",
                        scale: "1 = Nunca | 5 = Sempre"
                    },
                    {
                        id: "b2",
                        question: "Voc√™ bebia quando se sentia ansioso(a) ou preocupado(a)?",
                        type: "likert",
                        scale: "1 = Nunca | 5 = Sempre"
                    },
                    {
                        id: "b3",
                        question: "Situa√ß√µes sociais (festas, encontros) eram gatilhos para beber?",
                        type: "likert",
                        scale: "1 = Nunca | 5 = Sempre"
                    },
                    {
                        id: "b4",
                        question: "Voc√™ bebia para lidar com tristeza ou depress√£o?",
                        type: "likert",
                        scale: "1 = Nunca | 5 = Sempre"
                    },
                    {
                        id: "b5",
                        question: "Conflitos em relacionamentos te levavam a consumir √°lcool?",
                        type: "likert",
                        scale: "1 = Nunca | 5 = Sempre"
                    },
                    {
                        id: "b6",
                        question: "Ap√≥s beber, voc√™ se sentia culpado(a) ou envergonhado(a)?",
                        type: "likert",
                        scale: "1 = Nunca | 5 = Sempre"
                    },
                    {
                        id: "b7",
                        question: "O √°lcool afetou negativamente seus relacionamentos familiares?",
                        type: "likert",
                        scale: "1 = Nada | 5 = Muito"
                    },
                    {
                        id: "b8",
                        question: "Voc√™ teve problemas no trabalho ou estudos devido ao consumo de √°lcool?",
                        type: "likert",
                        scale: "1 = Nunca | 5 = Frequentemente"
                    },
                    {
                        id: "b9",
                        question: "O √°lcool prejudicou sua sa√∫de f√≠sica ou mental?",
                        type: "likert",
                        scale: "1 = Nada | 5 = Muito"
                    }
                ]
            },
            {
                title: "M√≥dulo C: Rede de Apoio e Motiva√ß√£o para a Sobriedade",
                icon: "üë•",
                color: "from-emerald-500 to-teal-600",
                questions: [
                    {
                        id: "c1",
                        question: "Voc√™ tem apoio de familiares na sua jornada de sobriedade?",
                        type: "likert",
                        scale: "1 = Nenhum apoio | 5 = Apoio total"
                    },
                    {
                        id: "c2",
                        question: "Seus amigos apoiam sua decis√£o de parar de beber?",
                        type: "likert",
                        scale: "1 = Nenhum apoio | 5 = Apoio total"
                    },
                    {
                        id: "c3",
                        question: "Voc√™ tem acesso a grupos de apoio (AA, terapia, etc.)?",
                        type: "multiple",
                        options: [
                            "N√£o tenho acesso",
                            "Tenho acesso mas n√£o participo",
                            "Participo ocasionalmente",
                            "Participo regularmente",
                            "Participo ativamente e sou engajado(a)"
                        ]
                    },
                    {
                        id: "c4",
                        question: "Qual √© sua principal motiva√ß√£o para parar de beber?",
                        type: "multiple",
                        options: [
                            "Sa√∫de f√≠sica",
                            "Sa√∫de mental e emocional",
                            "Relacionamentos familiares",
                            "Carreira profissional",
                            "Qualidade de vida geral"
                        ]
                    },
                    {
                        id: "c5",
                        question: "Voc√™ se sente confiante na sua capacidade de manter a sobriedade?",
                        type: "likert",
                        scale: "1 = Nada confiante | 5 = Muito confiante"
                    },
                    {
                        id: "c6",
                        question: "Voc√™ tem um plano claro para lidar com situa√ß√µes de risco?",
                        type: "likert",
                        scale: "1 = Nenhum plano | 5 = Plano muito claro"
                    },
                    {
                        id: "c7",
                        question: "Voc√™ pratica atividades alternativas saud√°veis (exerc√≠cios, hobbies)?",
                        type: "likert",
                        scale: "1 = Nunca | 5 = Sempre"
                    },
                    {
                        id: "c8",
                        question: "Voc√™ se sente motivado(a) a buscar ajuda profissional quando necess√°rio?",
                        type: "likert",
                        scale: "1 = Nada motivado | 5 = Muito motivado"
                    },
                    {
                        id: "c9",
                        question: "Voc√™ acredita que pode ter uma vida plena e feliz sem √°lcool?",
                        type: "likert",
                        scale: "1 = N√£o acredito | 5 = Acredito totalmente"
                    }
                ]
            }
        ];

        // Verificar sess√£o ao carregar
        async function checkSession() {
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                state.user = session.user;
                // Verificar se e-mail foi confirmado
                if (session.user.email_confirmed_at) {
                    await loadUserData();
                    state.screen = 'dashboard';
                } else {
                    state.screen = 'emailConfirm';
                }
            }
            render();
        }

        // Carregar dados do usu√°rio
        async function loadUserData() {
            const { data, error } = await supabase
                .from('users')
                .select('*')
                .eq('id', state.user.id)
                .single();

            if (data) {
                state.userName = data.name || '';
                state.soberDate = data.sober_date;
                state.isPremium = data.is_premium || false;
                state.answers = data.quiz_answers || {};
            }
        }

        // Fun√ß√µes auxiliares
        function getTotalQuestions() {
            return quizModules.reduce((acc, module) => acc + module.questions.length, 0);
        }

        function getAnsweredQuestions() {
            return Object.keys(state.answers).length;
        }

        function getOverallProgress() {
            return (getAnsweredQuestions() / getTotalQuestions()) * 100;
        }

        function getModuleProgress() {
            const currentModule = quizModules[state.currentModule];
            return ((state.currentQuestion + 1) / currentModule.questions.length) * 100;
        }

        function getSoberDays() {
            if (!state.soberDate) return 0;
            const diff = new Date() - new Date(state.soberDate);
            return Math.floor(diff / (1000 * 60 * 60 * 24));
        }

        // Handlers de autentica√ß√£o
        async function handleSignUp() {
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            const name = document.getElementById('authName').value;

            if (!email || !password || !name) {
                state.error = 'Preencha todos os campos';
                render();
                return;
            }

            state.loading = true;
            state.error = null;
            render();

            const { data, error } = await supabase.auth.signUp({
                email,
                password,
                options: {
                    data: {
                        name: name
                    }
                }
            });

            state.loading = false;

            if (error) {
                state.error = error.message;
                render();
                return;
            }

            // Criar registro do usu√°rio
            await supabase.from('users').insert({
                id: data.user.id,
                email: email,
                name: name,
                sober_date: new Date().toISOString(),
                created_at: new Date().toISOString()
            });

            state.user = data.user;
            state.userName = name;
            state.screen = 'emailConfirm';
            render();
        }

        async function handleLogin() {
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;

            if (!email || !password) {
                state.error = 'Preencha todos os campos';
                render();
                return;
            }

            state.loading = true;
            state.error = null;
            render();

            const { data, error } = await supabase.auth.signInWithPassword({
                email,
                password
            });

            state.loading = false;

            if (error) {
                state.error = error.message;
                render();
                return;
            }

            state.user = data.user;
            
            if (!data.user.email_confirmed_at) {
                state.screen = 'emailConfirm';
            } else {
                await loadUserData();
                state.screen = state.answers && Object.keys(state.answers).length > 0 ? 'dashboard' : 'quiz';
            }
            
            render();
        }

        async function handleResendEmail() {
            state.loading = true;
            render();

            const { error } = await supabase.auth.resend({
                type: 'signup',
                email: state.user.email
            });

            state.loading = false;

            if (error) {
                state.error = error.message;
            } else {
                alert('E-mail de confirma√ß√£o reenviado! Verifique sua caixa de entrada.');
            }

            render();
        }

        async function handleLogout() {
            await supabase.auth.signOut();
            state = {
                screen: 'auth',
                authMode: 'signup',
                currentModule: 0,
                currentQuestion: 0,
                answers: {},
                user: null,
                userName: '',
                soberDate: null,
                isPremium: false,
                loading: false,
                error: null
            };
            render();
        }

        // Handlers do quiz
        async function handleAnswer(answer) {
            const currentModule = quizModules[state.currentModule];
            const currentQuestion = currentModule.questions[state.currentQuestion];
            
            state.answers[currentQuestion.id] = answer;

            // Salvar progresso no banco
            await supabase
                .from('users')
                .update({ quiz_answers: state.answers })
                .eq('id', state.user.id);

            if (state.currentQuestion < currentModule.questions.length - 1) {
                state.currentQuestion++;
            } else if (state.currentModule < quizModules.length - 1) {
                state.currentModule++;
                state.currentQuestion = 0;
            } else {
                state.screen = 'plan';
            }
            
            render();
        }

        function handleBack() {
            if (state.currentQuestion > 0) {
                state.currentQuestion--;
            } else if (state.currentModule > 0) {
                state.currentModule--;
                state.currentQuestion = quizModules[state.currentModule].questions.length - 1;
            }
            render();
        }

        async function handlePlanSelection(isPremium) {
            state.isPremium = isPremium;
            
            // Atualizar no banco
            await supabase
                .from('users')
                .update({ is_premium: isPremium })
                .eq('id', state.user.id);
            
            state.screen = 'dashboard';
            render();
        }

        // Componentes de renderiza√ß√£o
        function renderAuth() {
            const isSignUp = state.authMode === 'signup';
            
            return `
                <div class="min-h-screen flex items-center justify-center p-4">
                    <div class="max-w-md w-full space-y-8 fade-in">
                        <div class="text-center space-y-4">
                            <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-emerald-500 to-teal-600 shadow-2xl mb-4">
                                <span class="text-4xl">üõ°Ô∏è</span>
                            </div>
                            <h1 class="text-5xl font-bold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent">
                                Status S√≥brio
                            </h1>
                            <p class="text-xl text-gray-600">
                                ${isSignUp ? 'Comece sua jornada de recupera√ß√£o' : 'Bem-vindo de volta'}
                            </p>
                        </div>

                        <div class="bg-white/80 backdrop-blur-sm p-8 rounded-2xl shadow-2xl border-0">
                            <div class="space-y-6">
                                ${state.error ? `
                                    <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm">
                                        ${state.error}
                                    </div>
                                ` : ''}

                                ${isSignUp ? `
                                    <div class="space-y-2">
                                        <label class="text-sm font-medium text-gray-700">Nome completo</label>
                                        <input
                                            id="authName"
                                            type="text"
                                            placeholder="Digite seu nome"
                                            class="w-full h-12 px-4 text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent"
                                        />
                                    </div>
                                ` : ''}

                                <div class="space-y-2">
                                    <label class="text-sm font-medium text-gray-700">E-mail</label>
                                    <input
                                        id="authEmail"
                                        type="email"
                                        placeholder="seu@email.com"
                                        class="w-full h-12 px-4 text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent"
                                    />
                                </div>

                                <div class="space-y-2">
                                    <label class="text-sm font-medium text-gray-700">Senha</label>
                                    <input
                                        id="authPassword"
                                        type="password"
                                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                        class="w-full h-12 px-4 text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent"
                                    />
                                </div>

                                <button
                                    onclick="${isSignUp ? 'handleSignUp()' : 'handleLogin()'}"
                                    ${state.loading ? 'disabled' : ''}
                                    class="w-full h-12 text-base bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white rounded-lg shadow-lg font-semibold transition-all disabled:opacity-50"
                                >
                                    ${state.loading ? 'Carregando...' : (isSignUp ? 'Criar Conta ‚Üí' : 'Entrar ‚Üí')}
                                </button>

                                <div class="text-center">
                                    <button
                                        onclick="state.authMode = '${isSignUp ? 'login' : 'signup'}'; state.error = null; render();"
                                        class="text-sm text-emerald-600 hover:text-emerald-700 font-medium"
                                    >
                                        ${isSignUp ? 'J√° tem uma conta? Fa√ßa login' : 'N√£o tem conta? Cadastre-se'}
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-3 gap-4 text-center">
                            <div class="space-y-1">
                                <div class="text-2xl font-bold text-emerald-600">10k+</div>
                                <div class="text-xs text-gray-600">Pessoas em recupera√ß√£o</div>
                            </div>
                            <div class="space-y-1">
                                <div class="text-2xl font-bold text-teal-600">95%</div>
                                <div class="text-xs text-gray-600">Taxa de sucesso</div>
                            </div>
                            <div class="space-y-1">
                                <div class="text-2xl font-bold text-cyan-600">24/7</div>
                                <div class="text-xs text-gray-600">Suporte dispon√≠vel</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderEmailConfirm() {
            return `
                <div class="min-h-screen flex items-center justify-center p-4">
                    <div class="max-w-md w-full space-y-8 fade-in">
                        <div class="text-center space-y-4">
                            <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-blue-500 to-cyan-600 shadow-2xl mb-4">
                                <span class="text-4xl">üìß</span>
                            </div>
                            <h1 class="text-4xl font-bold text-gray-800">
                                Confirme seu E-mail
                            </h1>
                            <p class="text-lg text-gray-600">
                                Enviamos um link de confirma√ß√£o para:
                            </p>
                            <p class="text-xl font-semibold text-emerald-600">
                                ${state.user?.email}
                            </p>
                        </div>

                        <div class="bg-white/80 backdrop-blur-sm p-8 rounded-2xl shadow-2xl border-0">
                            <div class="space-y-6">
                                <div class="space-y-3 text-gray-600">
                                    <p class="flex items-start gap-3">
                                        <span class="text-emerald-500 text-xl">‚úì</span>
                                        <span>Verifique sua caixa de entrada</span>
                                    </p>
                                    <p class="flex items-start gap-3">
                                        <span class="text-emerald-500 text-xl">‚úì</span>
                                        <span>Clique no link de confirma√ß√£o</span>
                                    </p>
                                    <p class="flex items-start gap-3">
                                        <span class="text-emerald-500 text-xl">‚úì</span>
                                        <span>Volte aqui e recarregue a p√°gina</span>
                                    </p>
                                </div>

                                <hr class="border-gray-200">

                                <button
                                    onclick="handleResendEmail()"
                                    ${state.loading ? 'disabled' : ''}
                                    class="w-full h-12 border-2 border-emerald-500 text-emerald-600 rounded-lg hover:bg-emerald-50 font-semibold transition-all disabled:opacity-50"
                                >
                                    ${state.loading ? 'Enviando...' : 'Reenviar E-mail'}
                                </button>

                                <button
                                    onclick="location.reload()"
                                    class="w-full h-12 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white rounded-lg shadow-lg font-semibold transition-all"
                                >
                                    J√° Confirmei - Continuar
                                </button>

                                <div class="text-center">
                                    <button
                                        onclick="handleLogout()"
                                        class="text-sm text-gray-500 hover:text-gray-700"
                                    >
                                        Sair
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg">
                            <p class="text-sm text-blue-700 text-center">
                                üí° N√£o recebeu o e-mail? Verifique a pasta de spam
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderQuiz() {
            const currentModule = quizModules[state.currentModule];
            const currentQuestion = currentModule.questions[state.currentQuestion];
            const moduleProgress = getModuleProgress();
            const overallProgress = getOverallProgress();

            let questionContent = '';
            
            if (currentQuestion.type === 'multiple') {
                questionContent = currentQuestion.options.map(option => `
                    <button
                        onclick="handleAnswer('${option}')"
                        class="p-4 text-left border-2 border-gray-200 rounded-xl hover:border-emerald-500 hover:bg-emerald-50 transition-all duration-200 group"
                    >
                        <div class="flex items-center justify-between">
                            <span class="text-gray-700 group-hover:text-emerald-700 font-medium">
                                ${option}
                            </span>
                            <span class="text-gray-400 group-hover:text-emerald-600">‚Üí</span>
                        </div>
                    </button>
                `).join('');
            } else {
                questionContent = `
                    <div class="space-y-4">
                        <div class="grid grid-cols-5 gap-3">
                            ${[1, 2, 3, 4, 5].map(value => `
                                <button
                                    onclick="handleAnswer(${value})"
                                    class="aspect-square flex flex-col items-center justify-center p-4 border-2 border-gray-200 rounded-xl hover:border-emerald-500 hover:bg-emerald-50 transition-all duration-200 group"
                                >
                                    <span class="text-3xl font-bold text-gray-700 group-hover:text-emerald-600">
                                        ${value}
                                    </span>
                                </button>
                            `).join('')}
                        </div>
                        <div class="flex items-center justify-between text-sm text-gray-500 px-1">
                            <span>Menor intensidade</span>
                            <span>Maior intensidade</span>
                        </div>
                    </div>
                `;
            }

            return `
                <div class="min-h-screen flex items-center justify-center p-4">
                    <div class="max-w-3xl w-full space-y-6 fade-in">
                        <div class="flex items-center justify-between">
                            <div class="text-sm text-gray-600">
                                Ol√°, ${state.userName}
                            </div>
                            <button
                                onclick="handleLogout()"
                                class="text-sm text-gray-500 hover:text-gray-700"
                            >
                                Sair
                            </button>
                        </div>

                        <div class="text-center space-y-3">
                            <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br ${currentModule.color} shadow-xl mb-2">
                                <span class="text-3xl">${currentModule.icon}</span>
                            </div>
                            <div class="inline-block bg-emerald-100 text-emerald-700 border border-emerald-200 text-sm px-4 py-1 rounded-full">
                                ${currentModule.title}
                            </div>
                            <h2 class="text-3xl font-bold text-gray-800">
                                Pergunta ${state.currentQuestion + 1} de ${currentModule.questions.length}
                            </h2>
                            <p class="text-sm text-gray-600">
                                Progresso geral: ${getAnsweredQuestions()} de ${getTotalQuestions()} perguntas respondidas
                            </p>
                        </div>

                        <div class="space-y-2">
                            <div class="flex items-center justify-between text-sm">
                                <span class="text-gray-600 font-medium">Progresso do m√≥dulo</span>
                                <span class="text-emerald-600 font-semibold">${Math.round(moduleProgress)}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-emerald-600 h-2 rounded-full progress-bar" style="width: ${moduleProgress}%"></div>
                            </div>
                        </div>

                        <div class="space-y-2">
                            <div class="flex items-center justify-between text-sm">
                                <span class="text-gray-600 font-medium">Progresso geral</span>
                                <span class="text-teal-600 font-semibold">${Math.round(overallProgress)}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-teal-600 h-2 rounded-full progress-bar" style="width: ${overallProgress}%"></div>
                            </div>
                        </div>

                        <div class="bg-white/90 backdrop-blur-sm p-8 rounded-2xl shadow-2xl border-0">
                            <div class="space-y-6">
                                <div class="space-y-3">
                                    <h3 class="text-xl font-semibold text-gray-800 leading-relaxed">
                                        ${currentQuestion.question}
                                    </h3>
                                    ${currentQuestion.type === 'likert' ? `
                                        <p class="text-sm text-gray-500 italic">
                                            ${currentQuestion.scale}
                                        </p>
                                    ` : ''}
                                </div>

                                <div class="grid gap-3">
                                    ${questionContent}
                                </div>
                            </div>
                        </div>

                        ${(state.currentQuestion > 0 || state.currentModule > 0) ? `
                            <button
                                onclick="handleBack()"
                                class="w-full h-12 border-2 border-gray-300 rounded-lg hover:bg-gray-50 font-medium transition-all"
                            >
                                ‚Üê Voltar
                            </button>
                        ` : ''}

                        <div class="flex items-center justify-center gap-2">
                            ${quizModules.map((_, index) => `
                                <div class="h-2 rounded-full transition-all ${
                                    index === state.currentModule
                                        ? 'w-8 bg-emerald-600'
                                        : index < state.currentModule
                                        ? 'w-2 bg-emerald-400'
                                        : 'w-2 bg-gray-300'
                                }"></div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderPlan() {
            return `
                <div class="min-h-screen flex items-center justify-center p-4">
                    <div class="max-w-4xl w-full space-y-8 fade-in">
                        <div class="text-center space-y-4">
                            <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-emerald-500 to-teal-600 shadow-xl mb-2">
                                <span class="text-3xl">‚ú®</span>
                            </div>
                            <h2 class="text-4xl font-bold text-gray-800">
                                Seu Plano Personalizado Est√° Pronto!
                            </h2>
                            <p class="text-xl text-gray-600">
                                Baseado nas suas ${getTotalQuestions()} respostas, criamos um programa sob medida para voc√™
                            </p>
                        </div>

                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="bg-white p-6 rounded-2xl shadow-lg border-2 border-gray-200">
                                <div class="space-y-6">
                                    <div>
                                        <h3 class="text-2xl font-bold text-gray-800">Plano B√°sico</h3>
                                        <div class="mt-2">
                                            <span class="text-4xl font-bold text-gray-800">Gr√°tis</span>
                                        </div>
                                    </div>

                                    <hr class="border-gray-200">

                                    <ul class="space-y-3">
                                        <li class="flex items-start gap-3">
                                            <span class="text-emerald-500 text-xl">‚úì</span>
                                            <span class="text-gray-600">Contador de dias s√≥brios</span>
                                        </li>
                                        <li class="flex items-start gap-3">
                                            <span class="text-emerald-500 text-xl">‚úì</span>
                                            <span class="text-gray-600">Registro di√°rio b√°sico</span>
                                        </li>
                                        <li class="flex items-start gap-3">
                                            <span class="text-emerald-500 text-xl">‚úì</span>
                                            <span class="text-gray-600">3 artigos educativos</span>
                                        </li>
                                        <li class="flex items-start gap-3 opacity-50">
                                            <span class="text-gray-400 text-xl">üîí</span>
                                            <span class="text-gray-400">Suporte 24/7 limitado</span>
                                        </li>
                                    </ul>

                                    <button
                                        onclick="handlePlanSelection(false)"
                                        class="w-full h-12 border-2 border-gray-300 rounded-lg hover:bg-gray-50 font-medium transition-all"
                                    >
                                        Continuar com B√°sico
                                    </button>
                                </div>
                            </div>

                            <div class="bg-gradient-to-br from-white to-emerald-50 p-6 rounded-2xl shadow-2xl border-2 border-emerald-500 relative overflow-hidden">
                                <div class="absolute top-4 right-4">
                                    <span class="bg-gradient-to-r from-emerald-500 to-teal-600 text-white text-xs px-3 py-1 rounded-full font-semibold">
                                        üëë Recomendado
                                    </span>
                                </div>

                                <div class="space-y-6">
                                    <div>
                                        <h3 class="text-2xl font-bold text-gray-800">Plano Premium</h3>
                                        <div class="mt-2 flex items-baseline gap-2">
                                            <span class="text-4xl font-bold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent">
                                                R$ 49,90
                                            </span>
                                            <span class="text-gray-500">/m√™s</span>
                                        </div>
                                    </div>

                                    <hr class="border-emerald-200">

                                    <ul class="space-y-3">
                                        <li class="flex items-start gap-3">
                                            <span class="text-emerald-600 text-xl">‚úì</span>
                                            <span class="text-gray-700 font-medium">Tudo do plano b√°sico +</span>
                                        </li>
                                        <li class="flex items-start gap-3">
                                            <span class="text-emerald-600 text-xl">‚úì</span>
                                            <span class="text-gray-700">An√°lise completa das 27 respostas</span>
                                        </li>
                                        <li class="flex items-start gap-3">
                                            <span class="text-emerald-600 text-xl">‚úì</span>
                                            <span class="text-gray-700">Plano personalizado por IA</span>
                                        </li>
                                        <li class="flex items-start gap-3">
                                            <span class="text-emerald-600 text-xl">‚úì</span>
                                            <span class="text-gray-700">Suporte 24/7 ilimitado</span>
                                        </li>
                                        <li class="flex items-start gap-3">
                                            <span class="text-emerald-600 text-xl">‚úì</span>
                                            <span class="text-gray-700">Comunidade exclusiva</span>
                                        </li>
                                        <li class="flex items-start gap-3">
                                            <span class="text-emerald-600 text-xl">‚úì</span>
                                            <span class="text-gray-700">Relat√≥rios de progresso avan√ßados</span>
                                        </li>
                                        <li class="flex items-start gap-3">
                                            <span class="text-emerald-600 text-xl">‚úì</span>
                                            <span class="text-gray-700">Biblioteca completa de conte√∫do</span>
                                        </li>
                                    </ul>

                                    <button
                                        onclick="handlePlanSelection(true)"
                                        class="w-full h-12 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white rounded-lg shadow-lg font-semibold transition-all"
                                    >
                                        Come√ßar Premium Agora üëë
                                    </button>

                                    <p class="text-xs text-center text-gray-500">
                                        Cancele quando quiser ‚Ä¢ Garantia de 7 dias
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="text-center">
                            <p class="text-sm text-gray-500">
                                üîí Pagamento seguro ‚Ä¢ Dados protegidos
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderDashboard() {
            const soberDays = getSoberDays();
            const moneySaved = soberDays * 30;
            const healthScore = Math.min(50 + soberDays, 100);

            return `
                <div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
                    <div class="gradient-bg text-white p-6 shadow-xl">
                        <div class="max-w-7xl mx-auto">
                            <div class="flex items-center justify-between mb-6">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center">
                                        <span class="text-2xl">üõ°Ô∏è</span>
                                    </div>
                                    <div>
                                        <h1 class="text-2xl font-bold">Status S√≥brio</h1>
                                        <p class="text-emerald-100 text-sm">Ol√°, ${state.userName}!</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-3">
                                    ${state.isPremium ? `
                                        <span class="bg-yellow-400 text-yellow-900 px-4 py-2 rounded-full font-semibold text-sm">
                                            üëë Premium
                                        </span>
                                    ` : ''}
                                    <button
                                        onclick="handleLogout()"
                                        class="text-sm text-white/80 hover:text-white"
                                    >
                                        Sair
                                    </button>
                                </div>
                            </div>

                            <div class="bg-white/10 backdrop-blur-md border border-white/20 p-8 rounded-2xl text-center">
                                <div class="space-y-2">
                                    <span class="text-5xl">üèÜ</span>
                                    <div class="text-6xl font-bold">${soberDays}</div>
                                    <div class="text-xl text-emerald-100">dias s√≥brio</div>
                                    <div class="text-sm text-emerald-200">
                                        Desde ${new Date(state.soberDate).toLocaleDateString('pt-BR')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="max-w-7xl mx-auto p-6 space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-2xl shadow-lg">
                                <div class="flex items-start justify-between">
                                    <div class="space-y-2">
                                        <p class="text-sm text-gray-600 font-medium">Dinheiro Economizado</p>
                                        <p class="text-3xl font-bold text-emerald-600">R$ ${moneySaved}</p>
                                        <p class="text-xs text-gray-500">‚âà R$ 30/dia</p>
                                    </div>
                                    <div class="w-12 h-12 rounded-full bg-emerald-100 flex items-center justify-center">
                                        <span class="text-2xl">üìà</span>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-br from-blue-50 to-cyan-50 p-6 rounded-2xl shadow-lg">
                                <div class="flex items-start justify-between">
                                    <div class="space-y-2">
                                        <p class="text-sm text-gray-600 font-medium">Score de Sa√∫de</p>
                                        <p class="text-3xl font-bold text-cyan-600">${healthScore}%</p>
                                        <p class="text-xs text-gray-500">Melhorando a cada dia</p>
                                    </div>
                                    <div class="w-12 h-12 rounded-full bg-cyan-100 flex items-center justify-center">
                                        <span class="text-2xl">üí™</span>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-br from-purple-50 to-pink-50 p-6 rounded-2xl shadow-lg">
                                <div class="flex items-start justify-between">
                                    <div class="space-y-2">
                                        <p class="text-sm text-gray-600 font-medium">Sequ√™ncia Atual</p>
                                        <p class="text-3xl font-bold text-purple-600">${soberDays} dias</p>
                                        <p class="text-xs text-gray-500">Continue assim! üéâ</p>
                                    </div>
                                    <div class="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center">
                                        <span class="text-2xl">‚ö°</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="bg-white p-6 rounded-2xl shadow-lg">
                                <div class="space-y-4">
                                    <div class="flex items-center gap-2">
                                        <span class="text-xl">üèÖ</span>
                                        <h3 class="text-lg font-semibold text-gray-800">Conquistas Recentes</h3>
                                    </div>

                                    <div class="space-y-3">
                                        ${soberDays >= 30 ? `
                                            <div class="flex items-center gap-3 p-3 bg-emerald-50 rounded-lg">
                                                <div class="w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center">
                                                    <span class="text-xl">üèÜ</span>
                                                </div>
                                                <div class="flex-1">
                                                    <p class="font-medium text-gray-800">30 Dias S√≥brio</p>
                                                    <p class="text-xs text-gray-500">Desbloqueado h√° ${soberDays - 30} dias</p>
                                                </div>
                                            </div>
                                        ` : ''}

                                        ${soberDays >= 7 ? `
                                            <div class="flex items-center gap-3 p-3 bg-blue-50 rounded-lg">
                                                <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center">
                                                    <span class="text-xl">üéØ</span>
                                                </div>
                                                <div class="flex-1">
                                                    <p class="font-medium text-gray-800">Primeira Semana</p>
                                                    <p class="text-xs text-gray-500">Desbloqueado h√° ${soberDays - 7} dias</p>
                                                </div>
                                            </div>
                                        ` : ''}

                                        <div class="flex items-center gap-3 p-3 bg-purple-50 rounded-lg">
                                            <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center">
                                                <span class="text-xl">‚ù§Ô∏è</span>
                                            </div>
                                            <div class="flex-1">
                                                <p class="font-medium text-gray-800">Quiz Completo</p>
                                                <p class="text-xs text-gray-500">27 perguntas respondidas</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white p-6 rounded-2xl shadow-lg">
                                <div class="space-y-4">
                                    <div class="flex items-center gap-2">
                                        <span class="text-xl">üéØ</span>
                                        <h3 class="text-lg font-semibold text-gray-800">Pr√≥ximas Metas</h3>
                                    </div>

                                    <div class="space-y-4">
                                        <div class="space-y-2">
                                            <div class="flex items-center justify-between text-sm">
                                                <span class="text-gray-600 font-medium">60 Dias S√≥brio</span>
                                                <span class="text-emerald-600 font-semibold">${Math.max(0, 60 - soberDays)} dias restantes</span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                <div class="bg-emerald-600 h-2 rounded-full progress-bar" style="width: ${Math.min((soberDays / 60) * 100, 100)}%"></div>
                                            </div>
                                        </div>

                                        <div class="space-y-2">
                                            <div class="flex items-center justify-between text-sm">
                                                <span class="text-gray-600 font-medium">R$ 2.000 Economizados</span>
                                                <span class="text-emerald-600 font-semibold">R$ ${Math.max(0, 2000 - moneySaved)} restantes</span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                <div class="bg-emerald-600 h-2 rounded-full progress-bar" style="width: ${Math.min((moneySaved / 2000) * 100, 100)}%"></div>
                                            </div>
                                        </div>

                                        <div class="space-y-2">
                                            <div class="flex items-center justify-between text-sm">
                                                <span class="text-gray-600 font-medium">100 Dias S√≥brio</span>
                                                <span class="text-emerald-600 font-semibold">${Math.max(0, 100 - soberDays)} dias restantes</span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                <div class="bg-emerald-600 h-2 rounded-full progress-bar" style="width: ${Math.min((soberDays / 100) * 100, 100)}%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        ${!state.isPremium ? `
                            <div class="bg-gradient-to-br from-emerald-50 to-teal-50 p-8 rounded-2xl shadow-lg border-2 border-emerald-200">
                                <div class="text-center space-y-4">
                                    <div class="w-16 h-16 rounded-full bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center mx-auto">
                                        <span class="text-3xl">üëë</span>
                                    </div>
                                    <h3 class="text-2xl font-bold text-gray-800">
                                        Desbloqueie Todo o Potencial
                                    </h3>
                                    <p class="text-gray-600 max-w-2xl mx-auto">
                                        Acesse an√°lise completa das suas 27 respostas, plano personalizado por IA, comunidade exclusiva, suporte 24/7 e muito mais
                                    </p>
                                    <button
                                        onclick="state.screen = 'plan'; render();"
                                        class="bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white px-6 py-3 rounded-lg shadow-lg font-semibold transition-all"
                                    >
                                        Fazer Upgrade para Premium üëë
                                    </button>
                                </div>
                            </div>
                        ` : ''}

                        <div class="bg-white p-6 rounded-2xl shadow-lg">
                            <div class="space-y-4">
                                <div class="flex items-center gap-2">
                                    <span class="text-xl">üìÖ</span>
                                    <h3 class="text-lg font-semibold text-gray-800">Como voc√™ est√° se sentindo hoje?</h3>
                                </div>

                                <div class="grid grid-cols-5 gap-3">
                                    ${[
                                        { emoji: "üòä", label: "√ìtimo" },
                                        { emoji: "üôÇ", label: "Bem" },
                                        { emoji: "üòê", label: "Neutro" },
                                        { emoji: "üòî", label: "Dif√≠cil" },
                                        { emoji: "üò¢", label: "Muito dif√≠cil" }
                                    ].map(mood => `
                                        <button
                                            class="p-4 text-4xl border-2 border-gray-200 rounded-xl hover:border-emerald-500 hover:bg-emerald-50 transition-all flex flex-col items-center gap-1"
                                            title="${mood.label}"
                                        >
                                            <span>${mood.emoji}</span>
                                            <span class="text-xs text-gray-600">${mood.label}</span>
                                        </button>
                                    `).join('')}
                                </div>

                                <button class="w-full h-12 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-semibold transition-all">
                                    Salvar Registro Di√°rio
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Fun√ß√£o principal de renderiza√ß√£o
        function render() {
            const app = document.getElementById('app');
            
            switch(state.screen) {
                case 'auth':
                    app.innerHTML = renderAuth();
                    break;
                case 'emailConfirm':
                    app.innerHTML = renderEmailConfirm();
                    break;
                case 'quiz':
                    app.innerHTML = renderQuiz();
                    break;
                case 'plan':
                    app.innerHTML = renderPlan();
                    break;
                case 'dashboard':
                    app.innerHTML = renderDashboard();
                    break;
            }
        }

        // Inicializar aplica√ß√£o
        checkSession();

        // Listener para mudan√ßas de autentica√ß√£o
        supabase.auth.onAuthStateChange((event, session) => {
            if (event === 'SIGNED_IN' && session?.user.email_confirmed_at) {
                state.user = session.user;
                loadUserData().then(() => {
                    state.screen = 'dashboard';
                    render();
                });
            }
        });
    </script>
</body>
</html>
